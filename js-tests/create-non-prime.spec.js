import {expect} from 'chai';
import {quantise, getImageData, guessLevels} from '../site/js/create-non-prime';

describe('getImageData', () => {
  it('should work with image data urls', async () => {
    const url = 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';

    const imageData = await getImageData(url, 1, 1);

    expect(imageData).deep.equals(new window.ImageData(1, 1));
  });
});

describe('quantise', () => {
  it('should quantise data stored in arrays', async () => {
    const input = [52, 43, 140, 20, 126, 61, 10, 45, 23, 166];

    const levels = [40, 70, 53];

    const expected = [1, 1, 3, 0, 3, 2, 0, 1, 0, 3];

    expect(quantise(input, input.slice().fill(0), levels)).deep.equals(expected);
  });
});

describe('guessLevels', () => {
  it('should guess consistant levels for Archer', async () => {
    const greyImage = {
      data: new Uint8Array([24, 18, 20, 20, 13, 22, 35, 34, 41, 75, 7, 82, 34, 5, 3, 60, 73, 72, 64, 66, 70, 93, 111, 122, 146, 136, 140, 145, 155, 109, 104, 112, 20, 2, 4, 4, 2, 3, 99, 1, 54, 26, 11, 118, 64, 78, 68, 56, 60, 65, 91, 107, 117, 141, 116, 130, 146, 155, 11, 0, 106, 50, 56, 8, 4, 1, 9, 114, 50, 1, 68, 89, 62, 68, 79, 69, 57, 62, 68, 91, 110, 117, 132, 102, 119, 140, 154, 4, 0, 133, 134, 113, 38, 17, 34, 48, 127, 93, 8, 52, 79, 71, 76, 78, 69, 69, 65, 69, 90, 109, 117, 90, 67, 70, 105, 151, 25, 87, 198, 192, 112, 116, 82, 61, 106, 147, 97, 78, 59, 38, 90, 252, 255, 255, 69, 86, 84, 90, 108, 113, 77, 92, 80, 56, 114, 137, 146, 209, 201, 140, 204, 194, 152, 140, 152, 255, 253, 63, 61, 249, 230, 246, 254, 255, 101, 101, 112, 127, 105, 76, 55, 55, 57, 51, 169, 145, 156, 182, 142, 194, 200, 182, 72, 250, 254, 254, 225, 61, 248, 114, 251, 245, 255, 109, 114, 115, 112, 86, 52, 5, 9, 43, 47, 203, 177, 119, 147, 129, 192, 192, 138, 255, 246, 237, 247, 241, 208, 243, 202, 171, 197, 254, 255, 67, 83, 69, 62, 51, 23, 20, 42, 61, 191, 170, 127, 158, 136, 81, 128, 96, 253, 246, 222, 51, 217, 210, 210, 252, 254, 245, 122, 131, 65, 82, 86, 96, 54, 14, 9, 31, 60, 173, 152, 189, 186, 155, 95, 104, 105, 22, 255, 160, 211, 239, 227, 227, 218, 250, 251, 75, 113, 75, 81, 107, 97, 35, 18, 23, 1, 28, 130, 144, 194, 137, 144, 118, 100, 115, 242, 253, 200, 205, 220, 239, 246, 254, 253, 250, 231, 79, 109, 168, 132, 131, 20, 21, 18, 5, 22, 194, 196, 219, 193, 199, 194, 184, 184, 248, 252, 187, 209, 223, 237, 241, 239, 255, 249, 253, 92, 111, 140, 223, 204, 53, 25, 20, 14, 11, 192, 192, 198, 207, 205, 199, 201, 193, 158, 253, 196, 200, 220, 229, 238, 246, 255, 254, 255, 184, 114, 119, 185, 161, 45, 38, 21, 27, 143, 80, 75, 81, 105, 91, 81, 94, 97, 69, 97, 68, 233, 237, 198, 250, 255, 254, 250, 241, 212, 61, 129, 103, 59, 59, 50, 37, 36, 93, 41, 39, 46, 48, 51, 51, 167, 177, 144, 90, 61, 62, 253, 251, 253, 253, 255, 190, 255, 37, 56, 20, 103, 91, 108, 93, 52, 49, 194, 173, 199, 128, 140, 202, 180, 222, 233, 148, 52, 58, 36, 172, 254, 248, 254, 244, 255, 255, 229, 56, 51, 65, 90, 93, 90, 71, 54, 192]),
      width: 29,
      height: 16
    };

    expect(guessLevels(greyImage, 3)).deep.equals([62, 112, 198]);
  });
});
